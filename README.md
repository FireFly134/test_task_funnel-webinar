# ТЗ Воронка-вбинар.

### Задание:
| Время          | Текст  | Точка отсчёта                                                                          | Триггеры на отмену отправки |           |
|----------------|--------|----------------------------------------------------------------------------------------|-----------------------------|-----------|
| 6min           | Текст1 | Первое сообщение клиента                                                               |                             | **msg_1** |
| 39min          | Текст2 | Время отправки сообщения **msg_1**                                                     | Триггер1 (это просто слово) | **msg_2** |
| 1 day 2 hours  | Текст3 | Время отправки сообщения **msg_2** или время, когда оно было отменено (найден триггер) |                             | **msg_3** |

**Примечание:** перед отправкой каждого сообщения проверять на наличие слов: ("прекрасно" | ИЛИ | "ожидать"). Если были найдены, то вся воронка прекращается.  
**Задание -- юзербот! Не путать с aiogram\telebot и тд ТГ ботами**

### Стек: 
```
ЯП: python
Модули:
pyrogram
sqlalchemy (asynpg)

***Не использовать механики scheduler.
Должен быть while True задача, которая для каждого сообщения проверяет ""готовых для получения сообщения"" пользователей."
```
### Обязательные столбцы БД:
```
id # ID пользователя
created_at # Время ""регистарции в воронку""
status # alive | dead | finished
status_updated_at  # Когда был обновлён столбец status

Объяснение по статусам:
alive --- по умолчанию, получаем только таких пользователей

dead --- если получили ошибки при отправке\проверке триггеров например: BotBlocked, UserDeactivated

finished --- конец воронки
```
	*Триггер -- в данном случае слово или фраза, найденная в каком-либо сообщении от нашего аккаунта (автоответчика), вызывающая такое-то действие. В данном случае: либо отмену отправки сообщения и переход к следующему, либо (если прекрасно\ожидать) окончание воронки						
    *Точка отсчёта -- в данном случае время, когда произошло такое-то событие. То есть отправить такой-то текст через Х "Время" от Y события						
	
---------------------------------------------------------------------------

пример `.env` файла, который должен лежать рядом с `Dockerfile`:
```commandline
API_ID=...
API_HASH=...
PHONE_NUMBER="Номер телефона аккаунта телеграм"

# POSTGRES
POSTGRES_DB=Название базы данных
POSTGRES_USER=Имя пользователя БД
POSTGRES_PASSWORD=Пароль пользователя от БД
```

Как получить API_ID и API_HASH? Все просто, проходим по ссылке [my.telegram.org](https://my.telegram.org/).  
Все официально, вводим номер телефона от аккаунта, вводим код подтверждения. 
Код подтверждения приходит на этот аккаунт от телеграм.
После того как прошли авторизацию, заходим [в приложения](https://my.telegram.org/apps),
если приложения нет, то предложит создать.  
После создания будет доступен API_ID и API_HASH и еще дополнительная информация.

### Теперь самое основное, запуск user_bot.  
Тут в принципе всё просто!  
Если у нет докера, установите его... ;)

Открываем консоль, если у вас linux, то проверьте что докер запущен:
`sudo systemctl status docker`, 
если выключен вводи команду:
`sudo systemctl start docker`

На ОС Window проще, запусти программу docker и все.


И после этого, через консоль, проходим в папку с проектом `cd ./путь до проекта/test_task_funnel-webinar/`  
отлично, осталось совсем чуть-чуть.
Вводим команду `sudo docker compose up`  
- если вводим первый раз, то нужно создать образ докера, просто добавь к этой команде `--build`  
- если хочешь чтобы докер запустил проект в режиме демона, добавь еще `-d`

Всё, мы наигрались пора выключать. 
Вводим команду `sudo docker compose down`
P.S.: Если вдруг выдает ошибку из-за того что нет "compose", попробуй `docker-compose`  
P.S.s.: Если ты работаешь на Window и у тебя выдает ошибку "команды `sudo` не существует", просто не используй в команде `sudo` ;)